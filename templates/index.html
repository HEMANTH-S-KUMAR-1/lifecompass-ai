<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Chatbot</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>Career Chatbot</h1>
        <div id="chat-box"></div>
        
        <div class="input-area">
            <h3>Ask Career Questions</h3>
            <div id="chat-error" class="error-message"></div>
            <input type="text" id="user-input" placeholder="Ask about career advice...">
            <button onclick="sendMessage()" id="send-btn">
                Send
                <span class="loading" id="send-loading" style="display: none;"></span>
            </button>
        </div>

        <div class="resume-upload">
            <h3>Upload Resume (PDF)</h3>
            <div id="resume-error" class="error-message"></div>
            <div id="resume-success" class="success-message"></div>
            <input type="file" id="resume-file" accept=".pdf">
            <button onclick="uploadResume()" id="resume-btn">
                Analyze Resume
                <span class="loading" id="resume-loading" style="display: none;"></span>
            </button>
        </div>

        <div class="skills-recommend">
            <h3>Job Recommendations</h3>
            <div id="skills-error" class="error-message"></div>
            <input type="text" id="skills-input" placeholder="Enter your skills (e.g., Python, JavaScript)">
            <button onclick="recommendJobs()" id="skills-btn">
                Get Recommendations
                <span class="loading" id="skills-loading" style="display: none;"></span>
            </button>
        </div>
    </div>

    <script>
        // Utility functions
        function showLoading(buttonId, loadingId) {
            document.getElementById(buttonId).disabled = true;
            document.getElementById(loadingId).style.display = 'inline-block';
        }

        function hideLoading(buttonId, loadingId) {
            document.getElementById(buttonId).disabled = false;
            document.getElementById(loadingId).style.display = 'none';
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 5000);
        }

        function showSuccess(elementId, message) {
            const successElement = document.getElementById(elementId);
            successElement.textContent = message;
            successElement.style.display = 'block';
            setTimeout(() => {
                successElement.style.display = 'none';
            }, 5000);
        }

        async function sendMessage() {
            const input = document.getElementById('user-input').value.trim();
            if (!input) {
                showError('chat-error', 'Please enter a message.');
                return;
            }
            appendMessage('You', input);

            try {
                showLoading('send-btn', 'send-loading');
                const res = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: input })
                });
                
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                
                const data = await res.json();
                appendMessage('Bot', data.response);
            } catch (err) {
                showError('chat-error', 'Error: ' + err.message);
                appendMessage('Bot', 'Sorry, I encountered an error. Please try again.');
            } finally {
                hideLoading('send-btn', 'send-loading');
                document.getElementById('user-input').value = '';
            }
        }

        async function uploadResume() {
            const fileInput = document.getElementById('resume-file');
            if (!fileInput.files.length) {
                showError('resume-error', 'Please select a PDF file.');
                return;
            }

            const file = fileInput.files[0];
            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                showError('resume-error', 'File size should be less than 5MB.');
                return;
            }

            const formData = new FormData();
            formData.append('resume', file);

            try {
                showLoading('resume-btn', 'resume-loading');
                const res = await fetch('/upload_resume', {
                    method: 'POST',
                    body: formData
                });
                
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                
                const data = await res.json();
                appendMessage('Bot', data.response);
                showSuccess('resume-success', 'Resume analyzed successfully!');
            } catch (err) {
                showError('resume-error', 'Error: ' + err.message);
                appendMessage('Bot', 'Sorry, I encountered an error analyzing your resume. Please try again.');
            } finally {
                hideLoading('resume-btn', 'resume-loading');
                fileInput.value = '';
            }
        }

        async function recommendJobs() {
            const skills = document.getElementById('skills-input').value.trim();
            if (!skills) {
                showError('skills-error', 'Please enter your skills.');
                return;
            }

            try {
                showLoading('skills-btn', 'skills-loading');
                const res = await fetch('/recommend_jobs', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ skills })
                });
                
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                
                const data = await res.json();
                appendMessage('Bot', data.response);
            } catch (err) {
                showError('skills-error', 'Error: ' + err.message);
                appendMessage('Bot', 'Sorry, I encountered an error getting job recommendations. Please try again.');
            } finally {
                hideLoading('skills-btn', 'skills-loading');
                document.getElementById('skills-input').value = '';
            }
        }

        function appendMessage(sender, message) {
            const chatBox = document.getElementById('chat-box');
            const div = document.createElement('div');
            div.className = sender === 'You' ? 'user-message' : 'bot-message';
            div.textContent = `${sender}: ${message}`;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // Event Listeners
        document.getElementById('user-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendMessage();
        });

        // Initial welcome message
        window.onload = function() {
            appendMessage('Bot', 'Hello! I\'m your career advisor. How can I help you today?');
        };
    </script>
</body>
</html>
